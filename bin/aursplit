#!/bin/bash
PS4='+(${BASH_SOURCE}:${LINENO}): ${FUNCNAME[0]:+${FUNCNAME[0]}(): }'
argv0=aursplit

readonly PS4 argv0

getbase() {
    declare -A pkg
    declare name base

    if [[ -r $1 ]]; then
        exec 3< "$1"
    else
        error "$argv0: $1: permission denied"
        exit 13
    fi

    while read -r -u 3 name base; do
        pkg[$name]=$base
    done

    # Values taken from stdin are not necessarily AUR targets (as for
    # the array above), so check if a value is set before printing to
    # prevent sparse files. Duplicates are removed from the bottom up.
    while read -r name _; do
        if [[ ${pkg[$name]} ]]; then
            printf '%s\n' "${pkg[$name]}"
        fi
    done | tac | awk '!x[$0]++' | tac
}

source /usr/share/makepkg/util.sh || exit

getbase "$1"

# vim: set et sw=4 sts=4 ft=sh:
