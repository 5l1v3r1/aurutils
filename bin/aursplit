#!/bin/bash
PS4='+(${BASH_SOURCE}:${LINENO}): ${FUNCNAME[0]:+${FUNCNAME[0]}(): }'
readonly argv0=aursplit

getbase() {
    declare -A pkg
    declare name base

    if [[ -r $1 ]]; then
        exec 3< "$1"
    else
        error "$argv0: $1: permission denied"
        exit 13
    fi

    while read -r -u 3 name base; do
        pkg[$name]=$base
    done

    # Values taken from stdin are not necessarily AUR targets (as for
    # the array above), so check if a value is set before printing to
    # prevent sparse files.
    while read -r name _; do
        if [[ ${pkg[$name]} ]]; then
            printf '%s\n' "${pkg[$name]}"
        fi
    done | datamash rmdup 1
}

if [[ ! -r $1 ]]; then
    error "$1: Permission denied"
    exit 13
fi

source /usr/share/makepkg/util.sh || exit
getbase "$1"
