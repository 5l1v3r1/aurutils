#!/bin/bash -
PATH=/bin:/usr/bin

argv0=repoman
tmp=$(mktemp -dt "$argv0".XXXXXXXXXX) || exit
official=(core testing extra community community-testing multilib multilib-testing)

readonly PATH argv0 tmp official

trap 'rm -rf "$tmp"' EXIT

# Regard ignored packages (#103)
printf '%s\n%s\n' "[options]" "$(pacconf IgnorePkg IgnoreGroup)" >> "$tmp"/config

for i in "${official[@]}"; do
    if pacconf --repo="$i" &>/dev/null; then
        printf '%s\n%s\n' "[$i]" "$(pacconf --repo="$i")" >> "$tmp"/config
    fi
done

pacman --config="$tmp"/config "$@"
