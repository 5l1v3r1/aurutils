.TH AUR-CHROOT 2018-05-20 AURUTILS
.SH NAME
aur\-chroot \- build packages with systemd-nspawn

.SH SYNOPSIS
.SY "aur chroot"
.OP \-d database
.OP \-D directory
.OP \-M makepkg_conf
.OP \-C pacman_conf
.OP \-\-no\-build
.OP \-\-no\-prepare
.OP \-\-
.RI [ "makechrootpkg args" ]
.YS

.SH DESCRIPTION
Build packages in an nspawn container, adding the results to a local
repository.

.SH OPTIONS
All arguments after \-\- are passed to \fBmakechrootpkg\fR.

.TP
.BI "\-D " directory
The base directory for containers. This directory usually contains a
.B /root
subdirectory that serves as template for user containers (named after
.I $SUDO_USER
, or
.B /copy
if unset).

.SY Note:
If the
.B \-T
parameter is specified to
.BR makechrootpkg ,
the user container has a random name and is removed on build
completion.

.TP
.BI "\-C " pacman_conf
The
.BR pacman.conf (5)
file used inside the container. Defaults to devtools'
.IR pacman-extra.conf .
This file is processed with
.BR pacconf (1)
to include necessary information from the host, such as mirrors. If a
local repository name is specified with
.BR \-d ,
its configuration is appended to this file.

.TP
.BI "\-M " makepkg_conf
The
.BR makepkg.conf (5)
file used inside the container. Defaults to devtools'
.IR makepkg\-<machine>.conf .

.TP
.B \-\-no\-build
Update or create the
.B /root
copy of the container; do not build a package.

.TP
.B \-\-no\-prepare
Build a package, do not update the container.

.TP
.B \-d
The local repository used inside the container. The first
.B Server
directive starting in
.B file://
is bind mounted (read-only).

.SH ENVIRONMENT
Packages are placed in the directory specified in
.BR PKGDEST .
If unset, the current directory (\fI$PWD\fR) is used. See also
.BR makepkg.conf (5).

.B AUR_REPO
.RS
The default local repository, see
.BR \-d .
.RE

.SH NOTES
.SS Using ccache and distcc
As in the example above, install the required packages:
.EX

  # arch-nspawn /var/lib/aurbuild/root pacman \-S ccache distcc

.EE

Ensure write access to
.B ccache
directories on the host:
.EX

  # aur chroot -- -d /home/_ccache:/build/.ccache -cu

.EE

Necessary
.BR makepkg (1)
options may be set in a specified (\-M)
.BR makepkg.conf (5)
file. See GitHub issue #334 for details.

.SS Building for a different architecture
To build packages for a different architecture, prepend
.BI setarch " arch"
to the
.B aur\-build
command line.

The target architecture must be supported both by the host (run
.B "setarch \-\-list"
for an approximation), and have a matching
.BR makepkg.conf (5)
file available in
.B /usr/share/devtools
(such as
.I /usr/share/devtools/makepkg\-i686.conf
for
.IR i686 ).

.SS Accessing the local repository
To install packages from the local repository (for example, on
dependency resolution with
.BR "makepkg \-s" ,
the container requires read access to the host directory where it is
located. This is ensured through a
.IR "bind mount" .

.SH SEE ALSO
.BR aur (1),
.BR aur\-build (1),
.BR pacconf (1),
.BR pacman (1),
.BR makepkg.conf (5),
.BR pacman.conf (5),
.BR setarch (8)

.SH AUTHORS
.MT https://github.com/AladW
Alad Wenter
.ME

.\" vim: set textwidth=72:
