.TH AUR\-BUILD 1 2018-04-12 AURUTILS
.SH NAME
aur\-build \- build packages to a local repository

.SH SYNOPSIS
.SY "aur build"
.OP "\-d" database
.OP \-cfNRsv
.OP \-a queue
.OP \--
.RI [ "makepkg args" ]
.YS

.SH DESCRIPTION
Build packages adding the results to a local repository, or a
.BR pacman (8)
repository configured with a
.I file://
prefix in
.BR pacman.conf (5).

.SH OPTIONS
All arguments after \-\- are passed to
.BR makepkg (8),
or
.BR aur\-chroot (1)
when
.B \-c
is specified.

.TP
.BI "\-a " queue
A text file describing directories that contain a PKGBUILD, relative to
the current directory. If unspecified, the current directory is assumed.

.TP
.B \-c
Build packages with
.BR aur\-chroot (1).

.TP
.BI "\-d " database
The name of the pacman database.

.TP
.B \-f
Continue the build process if a package with the same name is found
(ignoring the extension). Existing packages will be moved with a
.I ~
suffix.

.TP
.B \-N
Do not sync the local repository after building.

.TP
.BI "\-r " root
The root for the repository. The
.I root
is the location for the pacman database
.RI ( foo.db )
, built packages, and secondary files such as the files database
.RI ( foo.files ).
This defaults to the
.I Server
value of the configured repository.

.SY Note:
The
.I Server
value configured in
.B pacman.conf
is used for
.B pacman
sync operations regardless of this setting. See also
.BR \-N .

.TP
.B \-R
Remove old package files from disk when updating their entry in the
database
.RB ( "repo\-add \-R" ).

.TP
.B \-s
Sign built packages and the database
.RB ( "repo\-add \-s" )
with
.BR gpg (1).
To use another key than the default, the
.B GPGKEY
environment variable can be set to the appopriate key identifier.

.TP
.B \-v
Verify the PGP signature of the database before
updating.
.RB ( "repo\-add \-v" ).

.SH ENVIRONMENT
.B AUR_DBPATH
.RS
The absolute path to the repository.
.RE

.B AUR_REPO
.RS
The repository used for building packages. If unspecified, the name is
derived from
.BR AUR_DBPATH .
.RE

.SH NOTES
.SS Repository updates
When building locally (outside a container),
.B "pacman \-Syu"
is run while restricted to a local repository. This is comparable to
.BR "makepkg \-i" ,
but without subsequent package installation (if a package was
installed before, it is updated to the latest available version). An
interesting side-effect is that pacman considers packages inside the
official repositories "local", and warns if they are newer than any
custom counterpart. Packages which define a
.I replaces
field are ignored if the target package is installed on the local system.

Databases are built with
.B LANG=C
to avoid libalpm from skipping entries if the locale is not set
(FS#49342). Packages are signed manually with
.B "gpg \-\-batch \-\-detach\-sign \-\-no\-armor"
(FS#49946).

.SS Building with makechrootpkg
Changes to the pacman database are
.I not
propagated from the container to the local system. Packages must be
installed and updated separately, typically through
.BI "pacman \-Syu " package_name\fR.

Package conflicts inside the container must be solved manually, as
.B makechrootpkg
uses
.B "makepkg \-\-noconfirm \-s"
internally. For example, to replace
.I gcc
with
.I gcc\-multilib
, run
.B "arch\-nspawn /var/lib/aurbuild/root pacman \-S gcc\-multilib"
as root.

For further information, see
.BR aur\-chroot (1).

.SS Avoiding password prompts
.BR makepkg (8)
must be run as a regular user as of version 4.2, with privileged
operations done via
.BR sudo (8).
As such,
.BR aur\-build (1)
can not be run directly as root. To avoid password prompts,
.BR sudoers (5) can
be used instead.

For example:
.EX

  %build ALL = (root) NOPASSWD: SETENV: /usr/bin/makechrootpkg
  %build ALL = (root) NOPASSWD: /usr/bin/mkarchroot, /usr/bin/arch-nspawn

.EE

.SY Note:
If the rule should only apply to certain hosts, replace
.B ALL
with the respective
.IR hostname .

.SS PKGBUILD signatures
GPG signatures defined in the
.B validpgpkeys
array may be automatically retrieved by setting
.I "keyserver-options auto-key-retrieve"
in
.BR gpg.conf .
See
.BR gpg (1)
for details.

.SH SEE ALSO
.BR aur (1),
.BR aur\-chroot (1),
.BR aur\-repo (1),
.BR pacman (1),
.BR makepkg.conf (5),
.BR pacman.conf (5),
.BR makepkg (8),
.BR repo-add (8),
.BR setarch (8)

.SH AUTHORS
.MT https://github.com/AladW
Alad Wenter
.ME

.\" vim: set textwidth=72:
